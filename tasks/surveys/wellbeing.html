<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weekly Well-being Survey</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/uuid/8.3.2/uuid.min.js"></script>
    <script src="/tasks/common.js"></script>
    <script>
        async function handleSubmit() {
            const formData = new FormData(document.getElementById('surveyForm'));
            let event_index = 0;
            const summaryData = {};

            for (const [key, value] of formData.entries()) {
                await logEventGeneric({
                    eventType: 'survey_item',
                    itemId: key,
                    eventIndex: event_index,
                    payload: { value: value }
                });
                summaryData[key] = value;
                event_index++;
            }

            // Reverse-code the wst_confident item
            if (summaryData['wst_confident'] !== undefined) {
                summaryData['wst_confident'] = 4 - parseInt(summaryData['wst_confident']);
            }

            await finishSession();
            alert('Survey submitted!');
        }

        window.addEventListener('load', async () => {
            await initializeSessionMetadata('wellbeing', 'survey');
        });
    </script>
</head>
<body>
    <h1>Weekly Well-being Survey</h1>
    <form id="surveyForm" onsubmit="event.preventDefault(); handleSubmit();">
        <label for="wwb_cheerful">I felt cheerful and in good spirits</label>
        <input type="range" id="wwb_cheerful" name="wwb_cheerful" min="0" max="5" value="2">
        <br><br>

        <label for="wwb_calm">I felt calm and relaxed</label>
        <input type="range" id="wwb_calm" name="wwb_calm" min="0" max="5" value="2">
        <br><br>

        <label for="wwb_active">I felt active and vigorous</label>
        <input type="range" id="wwb_active" name="wwb_active" min="0" max="5" value="2">
        <br><br>

        <label for="wwb_fresh">I woke up feeling fresh and rested</label>
        <input type="range" id="wwb_fresh" name="wwb_fresh" min="0" max="5" value="2">
        <br><br>

        <label for="wwb_interested">Daily life was filled with things that interest me</label>
        <input type="range" id="wwb_interested" name="wwb_interested" min="0" max="5" value="2">
        <br><br>

        <label for="wst_unexpected">How often did unexpected things upset you?</label>
        <input type="range" id="wst_unexpected" name="wst_unexpected" min="0" max="4" value="2">
        <br><br>

        <label for="wst_control">How often did you feel unable to control important things?</label>
        <input type="range" id="wst_control" name="wst_control" min="0" max="4" value="2">
        <br><br>

        <label for="wst_confident">How often did you feel confident about handling problems?</label>
        <input type="range" id="wst_confident" name="wst_confident" min="0" max="4" value="2">
        <br><br>

        <label for="wst_overwhelmed">How often did difficulties pile up so high you couldnâ€™t overcome them?</label>
        <input type="range" id="wst_overwhelmed" name="wst_overwhelmed" min="0" max="4" value="2">
        <br><br>

        <button type="submit">Submit</button>
    </form>

    <script>
        window.onload = function() {
            initializeSessionMetadata('wellbeing', 'survey');
        };
    </script>
</body>
</html>
